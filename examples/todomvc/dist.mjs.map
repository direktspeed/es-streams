{"version":3,"file":"dist.mjs","sources":["src/model.mjs","src/action.mjs","src/view.jsx","src/index.mjs"],"sourcesContent":["// @flow\nexport type Id = number\n\nexport type Todo = {\n  description: string,\n  completed: boolean,\n  id: Id\n}\n\nexport const newTodo = (description: string, id: number): Todo =>\n  ({ description, completed: false, id })\n\nexport type Filter = '/' | '/active' | '/completed'\n\nexport type App = {\n  todos: Todo[],\n  focus: ?Id,\n  filter: Filter,\n  nextId: Id\n}\n\nexport const emptyApp: App =\n  { todos: [], focus: null, filter: '/', nextId: 0 }\n\nexport const completedCount = ({ todos }: App): number =>\n  todos.reduce(countIfCompleted, 0)\n\nconst countIfCompleted = (count, { completed }) =>\n  count + (completed ? 1 : 0)\n\nexport const addTodo = (description: string) => (app: App): App =>\n  ({\n    ...app,\n    nextId: app.nextId + 1,\n    todos: app.todos.concat([newTodo(description, app.nextId)])\n  })\n\nexport const removeTodo = (id: Id) => (app: App): App =>\n  ({\n    ...app,\n    todos: app.todos.filter(todo => todo.id !== id)\n  })\n\nexport const updateCompleted = (completed: boolean, id: Id) => (app: App): App =>\n  ({\n    ...app,\n    todos: app.todos.map(todo => todo.id === id ? { ...todo, completed } : todo)\n  })\n\nexport const updateAllCompleted = (completed: boolean) => (app: App): App =>\n  ({\n    ...app,\n    todos: app.todos.map(todo => ({ ...todo, completed }))\n  })\n\nexport const removeAllCompleted = (app: App): App =>\n  ({\n    ...app,\n    todos: app.todos.filter(todo => !todo.completed)\n  })\n\nexport const setFilter = (filter: Filter) => (app: App): App =>\n  ({\n    ...app,\n    filter\n  })\n\n// export const setFocus = (focus: ?Id) => (app: App): App =>\n//   ({\n//     ...app,\n//     focus\n//   })\n//\n// export const updateDescription = (description: string, id: Id) => (app: App): App =>\n//   ({\n//     ...app,\n//     todos: app.todos.map(todo => todo.id === id ? { ...todo, description } : todo)\n//   })\n","// @flow\n/* global HTMLElement, HTMLInputElement, Event, $Call */\nimport { id } from '@most/prelude'\nimport { type App, type Todo, addTodo, updateCompleted, removeTodo, updateAllCompleted, removeAllCompleted, setFilter } from './model.mjs'\n\ntype As<B, A = *> = $Call<A, A => B>\n\ntype DOMEvent<E> = { target: E } & Event\ntype InputEvent = DOMEvent<HTMLInputElement>\ntype ClickEvent = DOMEvent<HTMLElement>\ntype HashChangeEvent = { newURL: string } & Event\n\nconst ENTER_KEY = 'Enter'\n// const ESC_KEY = 'Escape'\n\nexport type Action = App => App\n\nexport const runAction = (app: App, action: Action): App =>\n  action(app)\n\nexport const handleAdd = (e: As<InputEvent>): Action => {\n  const value = e.target.value.trim()\n  if (e.key !== ENTER_KEY || value.length === 0) {\n    return id\n  }\n  e.target.value = ''\n  return addTodo(value)\n}\n\nexport const handleToggleAll = (e: As<InputEvent>): Action =>\n  updateAllCompleted(e.target.checked)\n\nexport const handleComplete = ({ id }: Todo) => (e: As<InputEvent>): Action =>\n  updateCompleted(e.target.checked, id)\n\nexport const handleRemove = ({ id }: Todo) => (e: As<ClickEvent>): Action =>\n  removeTodo(id)\n\nexport const handleRemoveAllCompleted = (e: As<InputEvent>): Action =>\n  removeAllCompleted\n\nexport const handleFilterChange = (e: As<HashChangeEvent>): Action =>\n  setFilter(e.newURL.replace(/^.*#/, ''))\n","// @flow\nimport { compose } from '@most/prelude'\nimport * as React from 'react'\nimport { type App, type Filter, type Todo, completedCount } from './model'\nimport { type Action, handleAdd, handleToggleAll, handleComplete, handleRemove, handleRemoveAllCompleted } from './action'\n\nconst maybeClass = (className: string) => (condition: bool): string =>\n  condition ? className : ''\nconst ifCompleted = maybeClass('completed')\nconst ifSelected = maybeClass('selected')\n\nconst filterTodos = ({ filter, todos }: App): Todo[] =>\n  todos.filter(t => {\n    switch (filter) {\n      case '/': return true\n      case '/active': return !t.completed\n      case '/completed': return t.completed\n    }\n  })\n\nexport const View = (addAction: Action => void) => (appState: App): React.Element<*> => {\n  const completed = completedCount(appState)\n  const todos = appState.todos\n  const filtered = filterTodos(appState)\n  const remaining = todos.length - completed\n\n  return <div>\n    <header className='header'>\n      <h1>todos</h1>\n      <input className='new-todo' name='new-todo' placeholder='What needs to be done?' autoComplete='off' autoFocus onKeyPress={compose(addAction, handleAdd)} />\n    </header>\n    <TodoList addAction={addAction} allCompleted={todos.length > 0 && remaining === 0}>\n      {filtered.map(todo =>\n        <TodoItem key={todo.id}\n          addAction={addAction}\n          todo={todo} />\n      )}\n    </TodoList>\n    {todos.length > 0 && <Footer addAction={addAction} remaining={remaining} completed={completed} filter={appState.filter} />}</div>\n}\n\ntype TodoListProps = {\n  children?: React.Node,\n  addAction: Action => void,\n  allCompleted: boolean\n}\n\nexport const TodoList = (props: TodoListProps): React.Element<*> =>\n  <section className='main'>\n    <input id='toggle-all' className='toggle-all' type='checkbox' checked={props.allCompleted} onChange={compose(props.addAction, handleToggleAll)} />\n    <label htmlFor='toggle-all'>Mark all as complete</label>\n    <ul className='todo-list'>\n      {props.children}\n    </ul>\n  </section>\n\ntype TodoProps = {\n  addAction: Action => void,\n  todo: Todo\n}\n\nexport const TodoItem = ({ addAction, todo }: TodoProps): React.Element<*> =>\n  <li className={ifCompleted(todo.completed)}>\n    <div className='view'>\n      <input className='toggle' type='checkbox' checked={todo.completed} onChange={compose(addAction, handleComplete(todo))} />\n      <label>{todo.description}</label>\n      <button className='destroy' onClick={compose(addAction, handleRemove(todo))} />\n    </div>\n    <input className='edit' value={todo.description} />\n  </li>\n\ntype FooterProps = {\n  addAction: Action => void,\n  remaining: number,\n  completed: number,\n  filter: Filter\n}\n\nexport const Footer = ({ addAction, remaining, completed, filter }: FooterProps): React.Element<*> =>\n  <footer className='footer'>\n    <span className='todo-count'><strong>{remaining}</strong> {remaining === 1 ? 'item' : 'items'} left</span>\n    <ul className='filters'>\n      <li><a className={ifSelected(filter === '/')} href='#/'>All</a></li>\n      <li><a className={ifSelected(filter === '/active')} href='#/active'>Active</a></li>\n      <li><a className={ifSelected(filter === '/completed')} href='#/completed'>Completed</a></li>\n    </ul>\n    {completed > 0 && <button className='clear-completed' onClick={compose(addAction, handleRemoveAllCompleted)}>Clear completed</button>}\n  </footer>\n","// @flow\n// TODO:\n// 1. localStorage\n// 2. todo editing\n/* global Document, Element */\nimport { skipRepeats, map, merge, scan, tap, runEffects } from '@most/core'\nimport { newDefaultScheduler } from '@most/scheduler'\nimport { hashchange } from '@most/dom-event'\nimport { createAdapter } from '@most/adapter'\n\nimport { emptyApp } from './model.mjs'\nimport { View } from './view.jsx'\nimport { handleFilterChange, runAction } from './action.mjs'\nimport * as ReactDOM from 'react-dom'\n\nconst fail = (s: string): empty => { throw new Error(s) }\nconst qs = (s: string, el: Document): Element =>\n  el.querySelector(s) || fail(`${s} not found`)\n\nconst appNode = qs('.todoapp', document)\nconst appState = emptyApp\nconst scheduler = newDefaultScheduler()\n\nconst [addAction, todoActions] = createAdapter()\n\nconst updateFilter = map(handleFilterChange, hashchange(window))\n\nconst actions = merge(todoActions, updateFilter)\n\nconst stateUpdates = skipRepeats(scan(runAction, appState, actions))\nconst viewUpdates = tap(rel => ReactDOM.render(rel, appNode), map(View(addAction), stateUpdates))\n\nrunEffects(viewUpdates, scheduler)\n"],"names":["newTodo","description","id","completed","emptyApp","todos","focus","filter","nextId","completedCount","reduce","countIfCompleted","count","addTodo","app","concat","removeTodo","todo","updateCompleted","map","updateAllCompleted","removeAllCompleted","setFilter","ENTER_KEY","runAction","action","handleAdd","e","value","target","trim","key","length","handleToggleAll","checked","handleComplete","handleRemove","handleRemoveAllCompleted","handleFilterChange","newURL","replace","maybeClass","className","condition","ifCompleted","ifSelected","filterTodos","t","View","addAction","appState","filtered","remaining","React.createElement","compose","TodoList","props","allCompleted","children","TodoItem","Footer","fail","s","Error","qs","el","querySelector","appNode","document","scheduler","newDefaultScheduler","todoActions","createAdapter","updateFilter","hashchange","window","actions","merge","stateUpdates","skipRepeats","scan","viewUpdates","tap","rel","ReactDOM","runEffects"],"mappings":"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"}